document.observe("click",function(e,t){if(t=e.findElement("form a.add_nested_fields")){var n=t.readAttribute("data-association"),a=t.readAttribute("data-target"),s=$(t.readAttribute("data-blueprint-id")),r=s.readAttribute("data-blueprint"),o=(t.getOffsetParent(".fields").firstDescendant().readAttribute("name")||"").replace(/\[[a-z_]+\]$/,""),l=r.match(new RegExp("\\[([a-z_]+)\\]\\[new_"+n+"\\]"));if(l&&(o=o.replace(new RegExp("\\["+l[1]+"\\]\\[(new_)?\\d+\\]$"),"")),o){var c=o.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],u=o.match(/[0-9]+/g)||[];for(i=0;i<c.length;i++)u[i]&&(r=r.replace(new RegExp("(_"+c[i]+")_.+?_","g"),"$1_"+u[i]+"_"),r=r.replace(new RegExp("(\\["+c[i]+"\\])\\[.+?\\]","g"),"$1["+u[i]+"]"))}var d=new RegExp("new_"+n,"g"),h=(new Date).getTime();r=r.replace(d,h);var p;return p=a?$$(a)[0].insert(r):t.insert({before:r}),p.fire("nested:fieldAdded",{field:p}),p.fire("nested:fieldAdded:"+n,{field:p}),!1}}),document.observe("click",function(e,t){if(t=e.findElement("form a.remove_nested_fields")){var i=t.previous(0),n=t.readAttribute("data-association");i&&(i.value="1");var a=t.up(".fields").hide();return a.fire("nested:fieldRemoved",{field:a}),a.fire("nested:fieldRemoved:"+n,{field:a}),!1}});