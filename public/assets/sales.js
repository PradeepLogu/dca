(function(){this.module("Dchq",function(){return this.module("Sale",function(){var e,t,i,a,n,r,o,s,l,c,u;return this.init=function(){return i(),$(".selectpicker").selectpicker(),$("#search_product").focus()},this.init_once=function(){return a(),o(),n(),r(),t(),$(".quantity select").live("change",function(){return u()}),$("#misc-product-modal").find("button[type='submit']").live("click",function(){return $("#misc-product-modal").modal("hide")}),$("#add-payment-modal select").live("change",function(){return"Gift Card"===$(this).find("option:selected").text()?$('#add-payment-modal input[type="number"]').attr("placeholder","Gift Card ID"):$('#add-payment-modal input[type="number"]').attr("placeholder","0.00")}),$("#sales form").live("submit",function(){return $("#add-payment-modal").modal("hide")}),$("a.print-receipt").live("click",function(e){return e.preventDefault(),$("#print").printElement()}),$("#product-lookup-modal").live("hidden",function(){return $("#product-lookup-modal #products").hide()}),$(".refund-checkbox input[type=checkbox]").live("change",function(){return $(".refund-checkbox input:checked").length>0&&$("tr.refund-total, .refund-total-dropdown").removeClass("hide"),0===$(".refund-checkbox input:checked").length?$("tr.refund-total, .refund-total-dropdown").addClass("hide"):void 0})},e=function(){var e;return e=$("form.sales"),"/sales/"+e.dom_id()+"/add_note.js"},s=function(e,t,i){var a,n;return null==t&&(t="json"),null==i&&(i=""),a=get_main_form(),n="/sales/"+a.dom_id()+"/"+e+"."+t,i&&(n+="?"+i),n},a=function(){return $("#add-note-modal .btn.btn-primary").click(function(t){var i;return t.preventDefault(),$("#add-note-modal").modal("hide"),i=$("#add-note-modal textarea").val(),$.post(e(),{note:i}).fail(function(){return Dchq.FlashMessages.error(I18n.t("purchase_orders.form.errors.error_adding_note"))})}),$(document).delegate("#edit-note","click",function(e){return e.preventDefault(),$("#add-note-modal textarea").val($("#note-holder").text()),$("#add-note-modal").modal("show")})},r=function(){return $("#search_product").live("keypress",function(e){return 13===e.keyCode?(e.preventDefault(),$.get(l("search_product"),{barcode:$(this).val()})):void 0})},l=function(e){return"/sales/"+$("form.sales").dom_id()+"/"+e+".js"},i=function(){return $("#search_product").autocomplete({minLength:2,select:function(e,t){return $.post(l("add_product"),{product_id:t.item.id,class_type:"Product"===t.item.class_type?"StoreProduct":t.item.class_type})},source:l("products_list")}),$("#search_customer").autocomplete({minLength:2,select:function(e,t){return $.post(l("add_customer"),{customer_id:t.item.id}),$("#assign-customer-modal").modal("hide")},source:l("customers_list")})},u=function(){return $("#sales form:first").submit()},o=function(){return $("a.save_as_layby, .cart_total a.btn-success.finalize-sale").live("click",function(){return $.get(l("mark_as_complete"),{status:$(this).attr("data-status")})})},c=function(e){return $.get(["",$(e).closest("div").attr("id"),$(e).attr("data-id")].join("/")+".json",function(e){return $("#product-lookup-modal #brands").hide(),$("#product-lookup-modal #categories").hide(),$("#product-lookup-modal #products").fill_in_selector(e).show()})},n=function(){return $("a.product-lookup").live("click",function(){return $("#product_lookup #products").hide(),$.get("/brands.json",function(e){return $("#product-lookup-modal #brands").fill_in_selector(e)}),$.get("/categories.json",function(e){return $("#product-lookup-modal #categories").fill_in_selector(e)})}),$("#product-lookup-modal #brands a").live("click",function(){return c(this)}),$("#product-lookup-modal #categories a").live("click",function(){return c(this)}),$("#product-lookup-modal #products a").live("click",function(){return $.post(l("add_product"),{product_id:$(this).attr("data-id"),class_type:"Product"}),$("#product-lookup-modal").modal("hide")})},t=function(){return $("td.discount").find("input").live("focusout",function(){return u()}),$("td.discount").find("select").live("change",function(){return u()})}})}),$(function(){return Dchq.Sale.init(),Dchq.Sale.init_once()})}).call(this);