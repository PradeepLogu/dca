// Copyright (C) 2012-2013 STAR MICRONICS CO., LTD. All Rights Reserved.
var StarWebPrintTrader=function(e){this.onError=this.onReceive=this.checkedblock=this.url=null,void 0!=e&&(void 0!=e.url&&(this.url=e.url),void 0!=e.checkedblock&&(this.checkedblock=e.checkedblock))};StarWebPrintTrader.prototype.sendMessage=function(e){var t="<root";void 0!=e.checkedblock?0==e.checkedblock&&(t+=' checkedblock="false"'):0==this.checkedblock&&(t+=' checkedblock="false"');var i,t=t+(">"+e.request+"</root>");i="<StarWebPrint><Request>",i+=this._encodeEscapeSequence(t),i+="</Request>",i+="</StarWebPrint>";var n=null;if(window.XMLHttpRequest)n=new XMLHttpRequest;else{if(!window.ActiveXObject)throw Error("XMLHttpRequest is not supported.");n=new ActiveXObject("Microsoft.XMLHTTP")}void 0!=e.url?n.open("POST",e.url,!0):n.open("POST",this.url,!0),n.setRequestHeader("Content-Type","text/xml; charset=UTF-8");var a=this;n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status){var e=n.responseXML.getElementsByTagName("Response");0<e.length?a.onReceive&&(e=e[0].childNodes[0].nodeValue,a.onReceive({traderSuccess:e.slice(e.indexOf("<success>")+9,e.indexOf("</success>")),traderCode:e.slice(e.indexOf("<code>")+6,e.indexOf("</code>")),traderStatus:e.slice(e.indexOf("<status>")+8,e.indexOf("</status>")),status:n.status,responseText:n.responseText})):a.onError&&a.onError({status:n.status,responseText:n.responseText})}else a.onError&&a.onError({status:n.status,responseText:n.responseText})},n.send(i)},StarWebPrintTrader.prototype.isCoverOpen=function(e){return 32&parseInt(e.traderStatus.substr(4,2),16)?!0:!1},StarWebPrintTrader.prototype.isOffLine=function(e){return 8&parseInt(e.traderStatus.substr(4,2),16)?!0:!1},StarWebPrintTrader.prototype.isCompulsionSwitchClose=function(e){return 4&parseInt(e.traderStatus.substr(4,2),16)?!0:!1},StarWebPrintTrader.prototype.isEtbCommandExecute=function(e){return 2&parseInt(e.traderStatus.substr(4,2),16)?!0:!1},StarWebPrintTrader.prototype.isHighTemperatureStop=function(e){return 64&parseInt(e.traderStatus.substr(6,2),16)?!0:!1},StarWebPrintTrader.prototype.isNonRecoverableError=function(e){return 32&parseInt(e.traderStatus.substr(6,2),16)?!0:!1},StarWebPrintTrader.prototype.isAutoCutterError=function(e){return 8&parseInt(e.traderStatus.substr(6,2),16)?!0:!1},StarWebPrintTrader.prototype.isBlackMarkError=function(e){return 8&parseInt(e.traderStatus.substr(8,2),16)?!0:!1},StarWebPrintTrader.prototype.isPaperEnd=function(e){return 8&parseInt(e.traderStatus.substr(10,2),16)?!0:!1},StarWebPrintTrader.prototype.isPaperNearEnd=function(e){return 4&parseInt(e.traderStatus.substr(10,2),16)?!0:!1},StarWebPrintTrader.prototype.extractionEtbCounter=function(e){var t=0;return 64&parseInt(e.traderStatus.substr(14,2),16)&&(t|=16),32&parseInt(e.traderStatus.substr(14,2),16)&&(t|=8),8&parseInt(e.traderStatus.substr(14,2),16)&&(t|=4),4&parseInt(e.traderStatus.substr(14,2),16)&&(t|=2),2&parseInt(e.traderStatus.substr(14,2),16)&&(t|=1),t},StarWebPrintTrader.prototype._encodeEscapeSequence=function(e){var t=/[<>&]/g;return t.test(e)&&(e=e.replace(t,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;"}return"&amp;"})),e};