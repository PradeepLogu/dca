!function(e){function t(t){function i(e){f.active&&(c(e),t.getPlaceholder().trigger("plotselecting",[s()]))}function n(t){1==t.which&&(document.body.focus(),void 0!==document.onselectstart&&null==m.onselectstart&&(m.onselectstart=document.onselectstart,document.onselectstart=function(){return!1}),void 0!==document.ondrag&&null==m.ondrag&&(m.ondrag=document.ondrag,document.ondrag=function(){return!1}),l(f.first,t),f.active=!0,g=function(e){a(e)},e(document).one("mouseup",g))}function a(e){return g=null,void 0!==document.onselectstart&&(document.onselectstart=m.onselectstart),void 0!==document.ondrag&&(document.ondrag=m.ondrag),f.active=!1,c(e),p()?r():(t.getPlaceholder().trigger("plotunselected",[]),t.getPlaceholder().trigger("plotselecting",[null])),!1}function s(){if(!p())return null;var i={},n=f.first,a=f.second;return e.each(t.getAxes(),function(e,t){if(t.used){var s=t.c2p(n[t.direction]),r=t.c2p(a[t.direction]);i[e]={from:Math.min(s,r),to:Math.max(s,r)}}}),i}function r(){var e=s();t.getPlaceholder().trigger("plotselected",[e]),e.xaxis&&e.yaxis&&t.getPlaceholder().trigger("selected",[{x1:e.xaxis.from,y1:e.yaxis.from,x2:e.xaxis.to,y2:e.yaxis.to}])}function o(e,t,i){return e>t?e:t>i?i:t}function l(e,i){var n=t.getOptions(),a=t.getPlaceholder().offset(),s=t.getPlotOffset();e.x=o(0,i.pageX-a.left-s.left,t.width()),e.y=o(0,i.pageY-a.top-s.top,t.height()),"y"==n.selection.mode&&(e.x=e==f.first?0:t.width()),"x"==n.selection.mode&&(e.y=e==f.first?0:t.height())}function c(e){null!=e.pageX&&(l(f.second,e),p()?(f.show=!0,t.triggerRedrawOverlay()):u(!0))}function u(e){f.show&&(f.show=!1,t.triggerRedrawOverlay(),e||t.getPlaceholder().trigger("plotunselected",[]))}function d(e,i){var n,a,s,r,o=t.getAxes();for(var l in o)if(n=o[l],n.direction==i&&(r=i+n.n+"axis",e[r]||1!=n.n||(r=i+"axis"),e[r])){a=e[r].from,s=e[r].to;break}if(e[r]||(n="x"==i?t.getXAxes()[0]:t.getYAxes()[0],a=e[i+"1"],s=e[i+"2"]),null!=a&&null!=s&&a>s){var c=a;a=s,s=c}return{from:a,to:s,axis:n}}function h(e,i){var n,a=t.getOptions();"y"==a.selection.mode?(f.first.x=0,f.second.x=t.width()):(n=d(e,"x"),f.first.x=n.axis.p2c(n.from),f.second.x=n.axis.p2c(n.to)),"x"==a.selection.mode?(f.first.y=0,f.second.y=t.height()):(n=d(e,"y"),f.first.y=n.axis.p2c(n.from),f.second.y=n.axis.p2c(n.to)),f.show=!0,t.triggerRedrawOverlay(),!i&&p()&&r()}function p(){var e=5;return Math.abs(f.second.x-f.first.x)>=e&&Math.abs(f.second.y-f.first.y)>=e}var f={first:{x:-1,y:-1},second:{x:-1,y:-1},show:!1,active:!1},m={},g=null;t.clearSelection=u,t.setSelection=h,t.getSelection=s,t.hooks.bindEvents.push(function(e,t){var a=e.getOptions();null!=a.selection.mode&&(t.mousemove(i),t.mousedown(n))}),t.hooks.drawOverlay.push(function(t,i){if(f.show&&p()){var n=t.getPlotOffset(),a=t.getOptions();i.save(),i.translate(n.left,n.top);var s=e.color.parse(a.selection.color);i.strokeStyle=s.scale("a",.8).toString(),i.lineWidth=1,i.lineJoin="round",i.fillStyle=s.scale("a",.4).toString();var r=Math.min(f.first.x,f.second.x),o=Math.min(f.first.y,f.second.y),l=Math.abs(f.second.x-f.first.x),c=Math.abs(f.second.y-f.first.y);i.fillRect(r,o,l,c),i.strokeRect(r,o,l,c),i.restore()}}),t.hooks.shutdown.push(function(t,a){a.unbind("mousemove",i),a.unbind("mousedown",n),g&&e(document).unbind("mouseup",g)})}e.plot.plugins.push({init:t,options:{selection:{mode:null,color:"#e8cfac"}},name:"selection",version:"1.1"})}(jQuery);